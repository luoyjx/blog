---
slug: 5729e465eab605745d4076ed
title: 利用Jenkins远程发布项目
tags: [jenkins-ci ,maven ,jdk ,tomcat]
---

在本机安装jdk，tomcat，maven，Jenkins，主要是Jenkins的配置。


jdk下载地址：http://www.oracle.com/technetwork/java/javase/downloads
tomcat下载地址：http://tomcat.apache.org/
maven下载地址：https://maven.apache.org/download.cgi
Jenkins下载地址：https://jenkins.io/index.html

tomcat和maven解压即可。
windows版jdk为exe文件，直接运行下一步...完成。
新增环境变量：
	JAVA_HOME=安装路径
	JRE_HOME=安装路径\jre
	CLASSPATH=.
	CATALINA_HOME=解压文件路径
	MAVEN_HOME=解压文件路径
	
修改环境变量，Path后面加入：
	%JAVA_HOME%\bin;%JRE_HOME%\bin;%CLASSPATH%;%CATALINA_HOME%\bin;%MAVEN_HOME%\bin
	
验证安装，打开命令框，输入：
	java -version 或者 javac
	mvn -v

把下载好的Jenkins包直接放在tomcat目录webapps下面，启动tomcat。
Jenkins就是Java编写的一个web项目。

访问地址：localhost:8081/jenkins

开始Jenkins的配置吧。
1.系统管理-系统设置
2.修改jdk安装和maven安装
3.填写别名，和刚才安装的路径
4.系统管理-插件管理
5.切换tab为可选插件（第二个tab）
6.搜索Publish Over SSH，勾选，直接安装
7.安装完成，继续系统设置
8.最下面配置Publish over SSH
9.基本设置的话，其他都不用填，SSH Servers添加
10.Name别称，Hostname远程服务器的地址，Username远程服务器登录用户名，Remote Directory可以设置为远程服务器tomcat的路径
11.点击高级，勾选Use password authentication, or use a different key，Username用户的密码
12.点击右下方的Test configuration， 提示成功，success，保存退出。


在远程服务器安装tomcat和jdk吧，我这是Linux（centos6.5 64位）系统。
jdk安装，我这下的是rpm包，命令：
	rpm -ivh jdk-8u77-linux-x64.rpm
	
默认安装到路径 /usr/java/.....
修改环境变量 /etc/profile，命令：
	vi /etc/profile
	
加入以下代码：
	JAVA_HOME=/usr/java/jdk1.8.0_77
	JRE_HOME=/usr/java/jdk1.8.0_77/jre
	CLASSPATH=$JAVA_HOME/lib:$JRE_HOME/lib
	export PATH=$PATH:$JAVA_HOME:$JRE_HOME:$CLASSPATH

退出编辑，使生效，验证安装情况，命令：
	source /etc/profile
	javac


tomcat安装，其实就解压包就行了，命令：
	cd /usr/local
	cp /root/apache-tomcat-9.0.0.M4.tar.gz .
	tar -zxvf apache-tomcat-9.0.0.M4.tar.gz
	mv apache-tomcat-9.0.0.M4 tomcat9
	
启动tomcat，命令：
	./tomcat9/bin/startup.sh
	
外网访问验证：
	http://192.168.211.129:8080/

小结：tomcat启动前得安装jdk，有依赖。tomcat默认端口8080，如果被占用，请修改tomcat/conf/server.xml，对http协议的8080端口进行修改，建议8000以上。jdk安装用rpm包和tar.gz包没差，rpm是默认安装地址/usr/java
,tar.gz包解压可以自行设置安装路径，最后在环境文件里面加入jdk配置即可。

访问不到的有可能是防火墙的问题，关闭防火墙命令：
	service iptables stop。



##########################################################################
##########################################################################
##########################################################################
做了这么些，开始简单的测试吧。
1.新建一个任务，选择第一个自由风格，名称test
2.勾选构建环境第二个Send files or execute commands over SSH after the build runs
3.Name 下来为刚才配置那个SSH Servers
4.Source files这是打包的文件，我们现在测试空项目，就不填了
5.Remove prefix这是去前缀，因为我们一般只希望把一个包放在容器里面，不需要新增路径
6.Remote directory远程路径/usr/local/tomcat9/webapps
7.Exec command这是shell脚本，我们就简单的写个脚本启动tomcat
	sh /usr/local/tomcat9/bin/startup.sh
8.保存退出

刚才我们是能正常的访问http://192.168.211.129:8080/，远程服务器的tomcat，现在我们在服务器手动停掉tomcat，应该是不能在访问了，点击Jenkins刚才新建的任务中，立即构建。构建完成后，在访问http://192.168.211.129:8080/，发现可以了，这就表示shell脚本已经执行。
Jenkins构建成功。


GG！
